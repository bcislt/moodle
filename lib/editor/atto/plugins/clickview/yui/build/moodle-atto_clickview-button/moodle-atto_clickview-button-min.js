YUI.add("moodle-atto_clickview-button",function(e,t){var n=function(){function p(n,s){r=window,i=s,this._target=n,this._version=e,this._handlers=t;if(!this._target)throw new Error("No target specified");if(!this._target.postMessage)throw new Error("Target element is not supported");if(r.addEventListener)r.addEventListener("message",f,!1);else{if(!r.attachEvent)throw new Error("Cannot attach event listener");r.attachEvent("onmessage",f)}return this}var e="1.1.1",t={},n=1,r=null,i=null,s=function(e){return e&&typeof e=="function"},o=function(){return n++},u=function(e,t){if(typeof e=="undefined"||!s(t))return;for(var n=0;n<e.length;n++){var r=e[n],i=t.apply(e,[r,n]);if(typeof i!="undefined")return i}},a=function(e,t,n){t=t||"",n=n;var r={type:t,data:n};e.postMessage(JSON.stringify(r),i||"*")},f=function(e){if(i&&i!==e.origin)return;var t={};try{t=JSON.parse(e.data)}catch(e){return}var n=t.data||{},s=t.type||"";if(e.source==r)return;h(s,n,e),h("message",n,e)},l=function(e,n,r,i){t[e]||(t[e]=[]);if(!s(n))return;n.guid||(n.guid=o());var a=u(t[e],function(e){if(e.fn.guid===n.guid)return!0});if(a)return;t[e].push({fn:n,once:!!r,ctx:i})},c=function(e,n){if(!t)return;if(!e)return;if(!t[e])return;if(!s(n)){delete t[e];return}u(t[e],function(e,t){e.fn.guid===n.guid&&this.splice(t,1)}),t[e].length===0&&delete t[e]},h=function(e,n,r){if(!t)return;if(!e)return;if(!t[e])return;u(t[e],function(e,t){if(s(e.fn)){var i=[r];e.fn.apply(e.ctx||null,i.concat(n))}e.once&&this.splice(t,1)})};return p.prototype={on:function(e,t,n){l(e,t,!1,n)},one:function(e,t,n){l(e,t,!0,n)},off:function(e,t){c(e,t)},trigger:function(e){a(this._target,e,Array.prototype.slice.call(arguments,1))}},p}();e.namespace("M.atto_clickview").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{name:"ClickView Plugin for Atto",initializer:function(e){this._onlineUrl=e.onlineUrl,this._consumerKey=e.consumerKey,this._schoolId=e.schoolId,e.allowIframe&&this.addButton({callback:this._displayDialog,iconurl:"https://"+this._onlineUrl+"/Assets/images/icons/cv-logo.png",tags:"iframe",icon:"clickview",iconComponent:"atto_clickview"})},_displayDialog:function(){var e=this.getDialogue({width:"824px"});e.set("headerContent","ClickView Plugin for Atto"),e.set("bodyContent",'<iframe id="cv-plugin-frame" src="'+this._onlineUrl+"/v3/plugins/base?consumerKey="+this._consumerKey+"&schoolId="+this._schoolId+'" width="800" height="494" frameborder="0"></iframe>').show();var t=this.get("host"),r=this,i=document.getElementById("cv-plugin-frame"),s=new n(i.contentWindow);s.on("cv-lms-addvideo",function(n,i){t.insertContentAtFocusPoint(i.embedHtml),e.hide(),s.off("cv-lms-addvideo"),r.markUpdated()},!0),e.on("visibleChange",function(e){if(e.newVal!==!1)return;s.off("cv-lms-addvideo")})}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
